# Prepare local env
make install-tools

# Build binary
GO111MODULE=on CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -trimpath -o ./bin/otelcontribcol_linux_amd64 -gcflags "all=-N -l" -ldflags "-X github.com/open-telemetry/opentelemetry-collector-contrib/internal/version.Version=v0.40.0-15-g61b560090" -tags "" ./cmd/otelcontribcol

# Build docker container
cp ../cmd/otelcontribcol vova-docker-otelcol/
cd vova-docker-otelcol
docker build -t 489198589229.dkr.ecr.eu-west-1.amazonaws.com/opentelemetry-collector-contrib:vova-5 .

# Login to ECR
aws ecr get-login-password --region eu-west-1 | docker login --username AWS --password-stdin 489198589229.dkr.ecr.eu-west-1.amazonaws.com

# Push to ECR
docker push 489198589229.dkr.ecr.eu-west-1.amazonaws.com/opentelemetry-collector-contrib:vova-5
